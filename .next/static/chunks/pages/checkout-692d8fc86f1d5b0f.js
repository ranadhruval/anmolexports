(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2222],{95338:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/checkout",function(){return s(68224)}])},68224:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>P});var i=s(85893),r=s(67294),l=s(31955),a=s(11163),n=s(38055),o=s(4976),d=s(34509),c=s(8642),u=s(69758),p=s(41248),m=s(41664),h=s.n(m),v=s(48813);let x=e=>{var t,s,r,l,a,n,o,d;let{register:c,errors:u}=e,{user:m}=(0,p.v9)(e=>e.auth);return(0,i.jsxs)("div",{className:"tp-checkout-bill-area",children:[(0,i.jsx)("h3",{className:"tp-checkout-bill-title",children:"Billing Details"}),(0,i.jsx)("div",{className:"tp-checkout-bill-form",children:(0,i.jsx)("div",{className:"tp-checkout-bill-inner",children:(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"tp-checkout-input",children:[(0,i.jsxs)("label",{children:["First Name ",(0,i.jsx)("span",{children:"*"})]}),(0,i.jsx)("input",{...c("firstName",{required:"firstName is required!"}),name:"firstName",id:"firstName",type:"text",placeholder:"First Name",defaultValue:null==m?void 0:m.firstName}),(0,i.jsx)(v.Z,{msg:null==u?void 0:null===(t=u.firstName)||void 0===t?void 0:t.message})]})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"tp-checkout-input",children:[(0,i.jsxs)("label",{children:["Last Name ",(0,i.jsx)("span",{children:"*"})]}),(0,i.jsx)("input",{...c("lastName",{required:"lastName is required!"}),name:"lastName",id:"lastName",type:"text",placeholder:"Last Name"}),(0,i.jsx)(v.Z,{msg:null==u?void 0:null===(s=u.lastName)||void 0===s?void 0:s.message})]})}),(0,i.jsx)("div",{className:"col-md-12",children:(0,i.jsxs)("div",{className:"tp-checkout-input",children:[(0,i.jsxs)("label",{children:["Country ",(0,i.jsx)("span",{children:"*"})]}),(0,i.jsx)("input",{...c("country",{required:"country is required!"}),name:"country",id:"country",type:"text",placeholder:"United States (US)"}),(0,i.jsx)(v.Z,{msg:null==u?void 0:null===(r=u.lastName)||void 0===r?void 0:r.message})]})}),(0,i.jsx)("div",{className:"col-md-12",children:(0,i.jsxs)("div",{className:"tp-checkout-input",children:[(0,i.jsx)("label",{children:"Street address"}),(0,i.jsx)("input",{...c("address",{required:"Address is required!"}),name:"address",id:"address",type:"text",placeholder:"House number and street name"}),(0,i.jsx)(v.Z,{msg:null==u?void 0:null===(l=u.address)||void 0===l?void 0:l.message})]})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"tp-checkout-input",children:[(0,i.jsx)("label",{children:"Town / City"}),(0,i.jsx)("input",{...c("city",{required:"City is required!"}),name:"city",id:"city",type:"text",placeholder:"City"}),(0,i.jsx)(v.Z,{msg:null==u?void 0:null===(a=u.city)||void 0===a?void 0:a.message})]})}),(0,i.jsx)("div",{className:"col-md-6",children:(0,i.jsxs)("div",{className:"tp-checkout-input",children:[(0,i.jsx)("label",{children:"Postcode ZIP"}),(0,i.jsx)("input",{...c("zipCode",{required:"zipCode is required!"}),name:"zipCode",id:"zipCode",type:"text",placeholder:"Postcode ZIP"}),(0,i.jsx)(v.Z,{msg:null==u?void 0:null===(n=u.zipCode)||void 0===n?void 0:n.message})]})}),(0,i.jsx)("div",{className:"col-md-12",children:(0,i.jsxs)("div",{className:"tp-checkout-input",children:[(0,i.jsxs)("label",{children:["Phone ",(0,i.jsx)("span",{children:"*"})]}),(0,i.jsx)("input",{...c("contactNo",{required:"ContactNumber is required!"}),name:"contactNo",id:"contactNo",type:"text",placeholder:"Phone"}),(0,i.jsx)(v.Z,{msg:null==u?void 0:null===(o=u.contactNo)||void 0===o?void 0:o.message})]})}),(0,i.jsx)("div",{className:"col-md-12",children:(0,i.jsxs)("div",{className:"tp-checkout-input",children:[(0,i.jsxs)("label",{children:["Email address ",(0,i.jsx)("span",{children:"*"})]}),(0,i.jsx)("input",{...c("email",{required:"Email is required!"}),name:"email",id:"email",type:"email",placeholder:"Email",defaultValue:null==m?void 0:m.email}),(0,i.jsx)(v.Z,{msg:null==u?void 0:null===(d=u.email)||void 0===d?void 0:d.message})]})}),(0,i.jsx)("div",{className:"col-md-12",children:(0,i.jsxs)("div",{className:"tp-checkout-input",children:[(0,i.jsx)("label",{children:"Order notes (optional)"}),(0,i.jsx)("textarea",{...c("orderNote",{required:!1}),name:"orderNote",id:"orderNote",placeholder:"Notes about your order, e.g. special notes for delivery."})]})})]})})})]})},j=e=>{let{handleCouponCode:t,couponRef:s,couponApplyMsg:l}=e,[a,n]=(0,r.useState)(!1),{coupon_info:o}=(0,p.v9)(e=>e.coupon);return(0,i.jsxs)("div",{className:"tp-checkout-verify-item",children:[(0,i.jsxs)("p",{className:"tp-checkout-verify-reveal",children:["Have a coupon?"," ",(0,i.jsx)("button",{onClick:()=>n(!a),type:"button",className:"tp-checkout-coupon-form-reveal-btn",children:"Click here to enter your code"})]}),a&&(0,i.jsxs)("div",{id:"tpCheckoutCouponForm",className:"tp-return-customer",children:[(0,i.jsxs)("form",{onSubmit:t,children:[(0,i.jsxs)("div",{className:"tp-return-customer-input",children:[(0,i.jsx)("label",{children:"Coupon Code :"}),(0,i.jsx)("input",{ref:s,type:"text",placeholder:"Coupon"})]}),(0,i.jsx)("button",{type:"submit",className:"tp-return-customer-btn tp-checkout-btn",children:"Apply"})]}),l&&(0,i.jsx)("p",{className:"p-2",style:{color:"green"},children:l})]})]})};var y=s(82383);let N=()=>{let[e,t]=(0,r.useState)(!1);return(0,i.jsxs)("div",{className:"tp-checkout-verify-item",children:[(0,i.jsxs)("p",{className:"tp-checkout-verify-reveal",children:["Returning customer?"," ",(0,i.jsx)("button",{onClick:()=>t(!e),type:"button",className:"tp-checkout-login-form-reveal-btn",children:"Click here to login"})]}),e&&(0,i.jsx)("div",{id:"tpReturnCustomerLoginForm",className:"tp-return-customer",children:(0,i.jsx)(y.Z,{})})]})};var g=s(86664),f=s(77517);let b=e=>{var t,s,r,l;let{checkoutData:a}=e,{handleShippingCost:n,cartTotal:o=0,stripe:d,isCheckoutSubmit:c,clientSecret:u,register:m,errors:h,showCard:x,setShowCard:j,shippingCost:y,discountAmount:N}=a,{cart_products:b}=(0,p.v9)(e=>e.cart),{total:C}=(0,f.Z)();return(0,i.jsxs)("div",{className:"tp-checkout-place white-bg",children:[(0,i.jsx)("h3",{className:"tp-checkout-place-title",children:"Your Order"}),(0,i.jsx)("div",{className:"tp-order-info-list",children:(0,i.jsxs)("ul",{children:[(0,i.jsxs)("li",{className:"tp-order-info-list-header",children:[(0,i.jsx)("h4",{children:"Product"}),(0,i.jsx)("h4",{children:"Total"})]}),b.map(e=>(0,i.jsxs)("li",{className:"tp-order-info-list-desc",children:[(0,i.jsxs)("p",{children:[e.title," ",(0,i.jsxs)("span",{children:[" x ",e.orderQuantity]})]}),(0,i.jsxs)("span",{children:["$",e.price.toFixed(2)]})]},e._id)),(0,i.jsxs)("li",{className:"tp-order-info-list-shipping",children:[(0,i.jsx)("span",{children:"Shipping"}),(0,i.jsxs)("div",{className:"tp-order-info-list-shipping-item d-flex flex-column align-items-end",children:[(0,i.jsxs)("span",{children:[(0,i.jsx)("input",{...m("shippingOption",{required:"Shipping Option is required!"}),id:"flat_shipping",type:"radio",name:"shippingOption"}),(0,i.jsxs)("label",{onClick:()=>n(60),htmlFor:"flat_shipping",children:["Delivery: Today Cost :",(0,i.jsx)("span",{children:"$60.00"})]}),(0,i.jsx)(v.Z,{msg:null==h?void 0:null===(t=h.shippingOption)||void 0===t?void 0:t.message})]}),(0,i.jsxs)("span",{children:[(0,i.jsx)("input",{...m("shippingOption",{required:"Shipping Option is required!"}),id:"flat_rate",type:"radio",name:"shippingOption"}),(0,i.jsxs)("label",{onClick:()=>n(20),htmlFor:"flat_rate",children:["Delivery: 7 Days Cost: ",(0,i.jsx)("span",{children:"$20.00"})]}),(0,i.jsx)(v.Z,{msg:null==h?void 0:null===(s=h.shippingOption)||void 0===s?void 0:s.message})]})]})]}),(0,i.jsxs)("li",{className:"tp-order-info-list-subtotal",children:[(0,i.jsx)("span",{children:"Subtotal"}),(0,i.jsxs)("span",{children:["$",C.toFixed(2)]})]}),(0,i.jsxs)("li",{className:"tp-order-info-list-subtotal",children:[(0,i.jsx)("span",{children:"Shipping Cost"}),(0,i.jsxs)("span",{children:["$",y.toFixed(2)]})]}),(0,i.jsxs)("li",{className:"tp-order-info-list-subtotal",children:[(0,i.jsx)("span",{children:"Discount"}),(0,i.jsxs)("span",{children:["$",N.toFixed(2)]})]}),(0,i.jsxs)("li",{className:"tp-order-info-list-total",children:[(0,i.jsx)("span",{children:"Total"}),(0,i.jsxs)("span",{children:["$",parseFloat(o).toFixed(2)]})]})]})}),(0,i.jsxs)("div",{className:"tp-checkout-payment",children:[(0,i.jsxs)("div",{className:"tp-checkout-payment-item",children:[(0,i.jsx)("input",{...m("payment",{required:"Payment Option is required!"}),type:"radio",id:"back_transfer",name:"payment",value:"Card"}),(0,i.jsx)("label",{onClick:()=>j(!0),htmlFor:"back_transfer","data-bs-toggle":"direct-bank-transfer",children:"Credit Card"}),x&&(0,i.jsx)("div",{className:"direct-bank-transfer",children:(0,i.jsx)("div",{className:"payment_card",children:(0,i.jsx)(g.CardElement,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"}},invalid:{color:"#9e2146"}}}})})}),(0,i.jsx)(v.Z,{msg:null==h?void 0:null===(r=h.payment)||void 0===r?void 0:r.message})]}),(0,i.jsxs)("div",{className:"tp-checkout-payment-item",children:[(0,i.jsx)("input",{...m("payment",{required:"Payment Option is required!"}),onClick:()=>j(!1),type:"radio",id:"cod",name:"payment",value:"COD"}),(0,i.jsx)("label",{htmlFor:"cod",children:"Cash on Delivery"}),(0,i.jsx)(v.Z,{msg:null==h?void 0:null===(l=h.payment)||void 0===l?void 0:l.message})]})]}),(0,i.jsx)("div",{className:"tp-checkout-btn-wrapper",children:(0,i.jsx)("button",{type:"submit",disabled:!d||c,className:"tp-checkout-btn w-100",children:"Place Order"})})]})};var C=s(27484),k=s(87536),S=s(9613),q=s(58193),O=s(35445),_=s(19209),I=s(69686);let Z=()=>{let{data:e,isError:t,isLoading:s}=(0,I.d)(),[l,{}]=(0,_.yX)(),[n,{}]=(0,_.HY)(),{cart_products:o}=(0,p.v9)(e=>e.cart),{user:d}=(0,p.v9)(e=>e.auth),{shipping_info:c}=(0,p.v9)(e=>e.order),{total:u,setTotal:m}=(0,f.Z)(),[h,v]=(0,r.useState)({}),[x,j]=(0,r.useState)(""),[y,N]=(0,r.useState)(0),[b,Z]=(0,r.useState)(0),[E,P]=(0,r.useState)(0),[T,F]=(0,r.useState)(0),[w,D]=(0,r.useState)(""),[A,z]=(0,r.useState)(!1),[B,U]=(0,r.useState)(""),[R,$]=(0,r.useState)(""),[Y,M]=(0,r.useState)(!1),[H,L]=(0,r.useState)(""),Q=(0,p.I0)(),X=(0,a.useRouter)(),V=(0,g.useStripe)(),J=(0,g.useElements)(),{register:K,handleSubmit:G,setValue:W,formState:{errors:ee}}=(0,k.cI)(),et=(0,r.useRef)("");(0,r.useEffect)(()=>{if(localStorage.getItem("couponInfo")){let e=JSON.parse(localStorage.getItem("couponInfo"));v(e),F(e.discountPercentage),N(e.minimumAmount),D(e.productType)}},[]),(0,r.useEffect)(()=>{(y-E>u||0===o.length)&&(F(0),localStorage.removeItem("couponInfo"))},[y,u,E,o]),(0,r.useEffect)(()=>{let e=null==o?void 0:o.filter(e=>e.productType===w),t=null==e?void 0:e.reduce((e,t)=>e+t.price*t.orderQuantity,0),s="",i=Number((u+b).toFixed(2)),r=Number(T/100*t);s=Number(i-r),P(r),j(s)},[u,b,T,o,w,E,x]),(0,r.useEffect)(()=>{x&&n({price:parseInt(x)}).then(e=>{var t;$(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.clientSecret)}).catch(e=>{console.log(e)})},[n,x]),(0,r.useEffect)(()=>{W("firstName",c.firstName),W("lastName",c.lastName),W("country",c.country),W("address",c.address),W("city",c.city),W("zipCode",c.zipCode),W("contactNo",c.contactNo),W("email",c.email),W("orderNote",c.orderNote)},[d,W,c,X]);let es=async e=>{Q((0,S.BM)(e)),z(!0);let t={name:"".concat(e.firstName," ").concat(e.lastName),address:e.address,contact:e.contactNo,email:e.email,city:e.city,country:e.country,zipCode:e.zipCode,shippingOption:e.shippingOption,status:"Pending",cart:o,paymentMethod:e.payment,subTotal:u,shippingCost:b,discount:E,totalAmount:x,orderNote:e.orderNote,user:"".concat(null==d?void 0:d._id)};if("Card"===e.payment){if(!V||!J)return;let e=J.getElement(g.CardElement);if(null==e)return;let{error:s,paymentMethod:i}=await V.createPaymentMethod({type:"card",card:e});if(!s||i)return U(""),ei({...t,cardInfo:i});U(s.message),z(!1)}"COD"===e.payment&&l({...t}).then(e=>{if(null==e?void 0:e.error);else{var t,s;localStorage.removeItem("cart_products"),localStorage.removeItem("couponInfo"),z(!1),(0,O.t5)("Your Order Confirmed!"),X.push("/order/".concat(null===(s=e.data)||void 0===s?void 0:null===(t=s.order)||void 0===t?void 0:t._id))}})},ei=async e=>{try{let{paymentIntent:t,error:s}=await V.confirmCardPayment(R,{payment_method:{card:J.getElement(g.CardElement),billing_details:{name:null==d?void 0:d.firstName,email:null==d?void 0:d.email}}});s&&(0,O.cB)(s.message);let i={...e,paymentIntent:t};l({...i}).then(e=>{if(null==e?void 0:e.error);else{var t,s;localStorage.removeItem("couponInfo"),(0,O.t5)("Your Order Confirmed!"),X.push("/order/".concat(null===(s=e.data)||void 0===s?void 0:null===(t=s.order)||void 0===t?void 0:t._id))}})}catch(e){console.log(e)}};return{handleCouponCode:r=>{var l,a,n,o;if(r.preventDefault(),!(null===(l=et.current)||void 0===l?void 0:l.value)){(0,O.cB)("Please Input a Coupon Code!");return}if(s)return(0,i.jsx)("h3",{children:"Loading..."});if(t)return(0,O.cB)("Something went wrong");let d=null==e?void 0:e.filter(e=>{var t;return e.couponCode===(null===(t=et.current)||void 0===t?void 0:t.value)});if(d.length<1){(0,O.cB)("Please Input a Valid Coupon!");return}if(C().isAfter(C(null===(a=d[0])||void 0===a?void 0:a.endTime))){(0,O.cB)("This coupon is not valid!");return}if(u<(null===(n=d[0])||void 0===n?void 0:n.minimumAmount)){(0,O.cB)("Minimum ".concat(d[0].minimumAmount," USD required for Apply this coupon!"));return}L("Your Coupon ".concat(d[0].title," is Applied on ").concat(d[0].productType," productType!")),N(null===(o=d[0])||void 0===o?void 0:o.minimumAmount),D(d[0].productType),F(d[0].discountPercentage),Q((0,q.NK)(d[0])),setTimeout(()=>{et.current.value="",L("")},5e3)},couponRef:et,handleShippingCost:e=>{Z(e)},discountAmount:E,total:u,shippingCost:b,discountPercentage:T,discountProductType:w,isCheckoutSubmit:A,setTotal:m,register:K,errors:ee,cardError:B,submitHandler:es,stripe:V,handleSubmit:G,clientSecret:R,setClientSecret:$,cartTotal:x,isCheckoutSubmit:A,couponApplyMsg:H,showCard:Y,setShowCard:M}},E=()=>{let e=Z(),{handleSubmit:t,submitHandler:s,register:r,errors:l,handleCouponCode:a,couponRef:n,couponApplyMsg:o}=e,{cart_products:d}=(0,p.v9)(e=>e.cart);return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)("section",{className:"tp-checkout-area pb-120",style:{backgroundColor:"#EFF1F5"},children:(0,i.jsxs)("div",{className:"container",children:[0===d.length&&(0,i.jsxs)("div",{className:"text-center pt-50",children:[(0,i.jsx)("h3",{className:"py-2",children:"No items found in cart to checkout"}),(0,i.jsx)(h(),{href:"/shop",className:"tp-checkout-btn",children:"Return to shop"})]}),d.length>0&&(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("div",{className:"col-xl-7 col-lg-7",children:(0,i.jsxs)("div",{className:"tp-checkout-verify",children:[(0,i.jsx)(N,{}),(0,i.jsx)(j,{handleCouponCode:a,couponRef:n,couponApplyMsg:o})]})}),(0,i.jsx)("form",{onSubmit:t(s),children:(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("div",{className:"col-lg-7",children:(0,i.jsx)(x,{register:r,errors:l})}),(0,i.jsx)("div",{className:"col-lg-5",children:(0,i.jsx)(b,{checkoutData:e})})]})})]})]})})})},P=()=>{let e=(0,a.useRouter)();return(0,r.useEffect)(()=>{l.Z.get("userInfo")||e.push("/login")},[e]),(0,i.jsxs)(o.Z,{children:[(0,i.jsx)(n.Z,{pageTitle:"Checkout"}),(0,i.jsx)(d.Z,{style_2:!0}),(0,i.jsx)(u.Z,{title:"Checkout",subtitle:"Checkout",bg_clr:!0}),(0,i.jsx)(E,{}),(0,i.jsx)(c.Z,{style_2:!0})]})}},19209:(e,t,s)=>{"use strict";s.d(t,{HY:()=>l,SB:()=>o,T2:()=>n,yX:()=>a});var i=s(60454),r=s(9613);let{useCreatePaymentIntentMutation:l,useSaveOrderMutation:a,useGetUserOrderByIdQuery:n,useGetUserOrdersQuery:o}=i.g.injectEndpoints({overrideExisting:!0,endpoints:e=>({createPaymentIntent:e.mutation({query:e=>({url:"https://shofy-backend.vercel.app/api/order/create-payment-intent",method:"POST",body:e}),async onQueryStarted(e,t){let{queryFulfilled:s,dispatch:i}=t;try{let e=await s;i((0,r.SZ)(e.clientSecret))}catch(e){}}}),saveOrder:e.mutation({query:e=>({url:"https://shofy-backend.vercel.app/api/order/saveOrder",method:"POST",body:e}),invalidatesTags:["UserOrders"],async onQueryStarted(e,t){let{queryFulfilled:s,dispatch:i}=t;try{await s&&(localStorage.removeItem("couponInfo"),localStorage.removeItem("cart_products"),localStorage.removeItem("shipping_info"))}catch(e){}}}),getUserOrders:e.query({query:()=>"https://shofy-backend.vercel.app/api/user-order",providesTags:["UserOrders"],keepUnusedDataFor:600}),getUserOrderById:e.query({query:e=>"https://shofy-backend.vercel.app/api/user-order/".concat(e),providesTags:(e,t,s)=>[{type:"UserOrder",id:s}],keepUnusedDataFor:600})})})}},e=>{var t=t=>e(e.s=t);e.O(0,[6911,2216,5735,8554,8642,4509,4010,2888,9774,179],()=>t(95338)),_N_E=e.O()}]);